<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facility Watch</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f4f6f9; padding-top: 2rem; }
        .card { transition: transform 0.2s; cursor: default; }
        .card:hover { transform: translateY(-5px); }
    </style>
</head>
<body>

    <div class="container">
        <h2 class="mb-4 fw-bold text-primary">ðŸ“‹ Laporan Fasilitas</h2>
        
        <div id="reports" class="row g-4">
            <div class="col-12 text-center mt-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p>Loading data...</p>
            </div>
        </div>
    </div>

    <script>
        // Ganti dengan URL Backend Cloud Run kamu yang asli
        const API_URL = "https://backend-service-255243454378.asia-southeast2.run.app";

        // Helper: Bikin warna badge status otomatis
        function getBadge(status) {
            const s = status.toLowerCase();
            if (s.includes('selesai') || s.includes('completed')) return 'bg-success';
            if (s.includes('proses') || s.includes('progress')) return 'bg-warning text-dark';
            return 'bg-danger'; // Default (Pending)
        }

        async function loadReports() {
            try {
                const res = await fetch(`${API_URL}/reports`);
                const data = await res.json();
                const container = document.getElementById("reports");

                // Handle jika data kosong
                if (data.length === 0) {
                    container.innerHTML = `<div class="col-12 text-center text-muted"><h5>Belum ada laporan masuk.</h5></div>`;
                    return;
                }

                // Render Data ke Card Bootstrap
                container.innerHTML = data.map(r => `
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm border-0">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <span class="badge bg-secondary opacity-75">${r.facility}</span>
                                    <span class="badge ${getBadge(r.status)} rounded-pill">${r.status}</span>
                                </div>
                                <h5 class="card-title fw-bold text-dark mt-2">${r.title}</h5>
                                <p class="card-text text-secondary small">${r.description}</p>
                            </div>
                            <div class="card-footer bg-white border-0 pt-0">
                                <small class="text-muted" style="font-size: 0.75rem;">
                                    ID: #${r.id} &bull; ${new Date(r.created_at).toLocaleDateString('id-ID')}
                                </small>
                            </div>
                        </div>
                    </div>
                `).join("");

            } catch (error) {
                console.error(error);
                document.getElementById("reports").innerHTML = `
                    <div class="col-12 text-center text-danger">
                        Failed to load data from backend.
                    </div>`;
            }
        }

        // Jalankan fungsi
        loadReports();
    </script>
</body>
</html>